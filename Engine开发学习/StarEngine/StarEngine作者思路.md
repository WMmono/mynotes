# 请问游戏中如何设计存在相互覆盖的角色状态？


把buff机制做成一个图（graph）。每个buff是一个节点，每个状态也是一个节点。现在无敌状态受两种状态影响（A、C），那么A、C各有一条边指向无敌状态。无敌状态判定时，遍历所有输入节点（也就是A、C），有一个buff生效就生效。A、C如果也有自己的状态依赖，那就进行深度遍历依次判定。如果存在“覆盖”，比如例子中b buff覆盖a buff，那么B有一条边指向A，判定时B的优先级比A高。A取消了，B还在生效。整个graph必须是个有向无圈图（DAG），有圈说明循环依赖，判定时会宕机（halting）。DAG可以进行拓扑排序，排完序后就是个一维数组，每帧可以按照这个优先级进行判定，省去了深度遍历的消耗，实现更简单。不建议手动给状态排优先级，维护起来费劲。

作者：Star.E
链接：https://www.zhihu.com/question/485494046/answer/2135820927
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。


还有我觉得分层设计比单一个配置层要好，比如一个材质，策划层（调调参数），美术层（基于shader graph的材质制作），技术层（shader 和 shader library 等）和专家层（shading model 和 render pipeline 等），可以参考 unity 的设计思路。当然这么搞的工作量挺爆炸的23333。


不知道材质shader部分会怎么设计来做到平台独立了，bgfx或vulkan虚拟机应该不错，这样就简单跨平台渲染了，想等渲染部分发上去自己做试试看，日常用mac还想试试在mac上编译，当然vulkan做出来moltenvk也要试的，有个平台能自己瞎jb定制化最好了

rhi粒度很细，每个图形api都要暴露。bytecode粒度很粗，比如一条指令可能只有“画地形”，怎么画交给虚拟机了，不同虚拟机会有不同实现。


























